<% if @can_add %>
  <!-- 他ユーザーのメモを追加 -->
  <div class="memo-form">
    <%= form_with model: @memo_to_add, 
                  url: add_memo_memo_path(@selected), 
                  method: :post, 
                  local: true,
                  data: { controller: "memo-form" } do |f| %>

      
      <div class="form-body">
        <div class="input-group">
          <label class="label" for="memo_to_add_title">タイトル</label>
          <%= f.text_field :title, 
                          placeholder: "メモのタイトルを入力", 
                          class: "input title-input",
                          id: "memo_to_add_title" %>
        </div>
        
        <!-- タグ入力 -->
        <div class="input-group">
          <label class="label" for="memo_to_add_tags">タグ</label>
          <input type="text" 
                 name="tags" 
                 id="memo_to_add_tags"
                 placeholder="タグをカンマ区切りで入力（例: 仕事, アイデア）" 
                 class="input tags-input">
        </div>
        
        <div class="input-group">
          <label class="label" for="memo_to_add_description">内容</label>
          <%= f.text_area :description, 
                         placeholder: "メモの内容を入力してください...", 
                         class: "input content-textarea",
                         rows: 20,
                         id: "memo_to_add_description" %>
        </div>
      </div>
      
      <div class="form-actions">
        <!-- 公開設定 -->
        <div class="visibility-group">
          <label class="label" for="memo_to_add_visibility">公開設定</label>
          <%= f.select :visibility, 
                      options_for_select([
                        ['プライベート', :private_memo],
                        ['公開', :public_memo],
                        ['共有', :shared]
                      ], @memo_to_add.visibility),
                      {},
                      { class: "input", id: "memo_to_add_visibility" } %>
        </div>
        
        <div class="action-buttons">
          <%= f.submit "追加", class: "btn btn-primary" %>
          <%= link_to "キャンセル", root_path, class: "btn btn-secondary" %>
        </div>
      </div>
    <% end %>
  </div>
<% elsif @selected.present? %>
  <!-- 自分のメモの編集 -->
  <div class="memo-form">
    <%= form_with model: @selected, 
                  local: true,
                  data: { controller: "memo-form" } do |f| %>

      
      <div class="form-body">
        <div class="input-group">
          <label class="label" for="memo_edit_title">タイトル</label>
          <%= f.text_field :title, 
                          placeholder: "メモのタイトルを入力", 
                          class: "input title-input",
                          id: "memo_edit_title" %>
        </div>
        
        <!-- タグ入力 -->
        <div class="input-group">
          <label class="label" for="memo_edit_tags">タグ</label>
          <input type="text" 
                 name="tags" 
                 id="memo_edit_tags"
                 value="<%= @selected.tags.pluck(:name).join(', ') %>"
                 placeholder="タグをカンマ区切りで入力（例: 仕事, アイデア）" 
                 class="input tags-input">
        </div>
        
        <div class="input-group">
          <label class="label" for="memo_edit_description">内容</label>
          <%= f.text_area :description, 
                         placeholder: "メモの内容を入力してください...", 
                         class: "input content-textarea",
                         rows: 20,
                         id: "memo_edit_description" %>
        </div>
      </div>
      
      <div class="form-actions">
        <!-- 公開設定 -->
        <div class="visibility-group">
          <label class="label" for="memo_edit_visibility">公開設定</label>
          <%= f.select :visibility, 
                      options_for_select([
                        ['プライベート', :private_memo],
                        ['公開', :public_memo],
                        ['共有', :shared]
                      ], @selected.visibility),
                      {},
                      { class: "input", id: "memo_edit_visibility" } %>
        </div>
        
        <div class="action-buttons">
          <%= f.submit "更新", class: "btn btn-primary" %>
          <%= button_to "削除", memo_path(@selected.id), 
                        method: :delete, 
                        class: "btn btn-destructive",
                        data: { 
                          confirm: "本当に削除しますか？この操作は取り消せません。",
                          turbo_method: :delete
                        },
                        title: "このメモを完全に削除します" %>
        </div>
      </div>
    <% end %>
  </div>
<% else %>
  <!-- 新規メモ作成 -->
  <div class="memo-form">
    <%= form_with model: @memo_new, 
                  url: memos_path, 
                  method: :post, 
                  local: true,
                  data: { controller: "memo-form" } do |f| %>

      
      <div class="form-body">
        <div class="input-group">
          <label class="label" for="memo_new_title">タイトル</label>
          <%= f.text_field :title, 
                          placeholder: "メモのタイトルを入力", 
                          class: "input title-input",
                          id: "memo_new_title" %>
        </div>
        
        <!-- タグ入力 -->
        <div class="input-group">
          <label class="label" for="memo_new_tags">タグ</label>
          <input type="text" 
                 name="tags" 
                 id="memo_new_tags"
                 placeholder="タグをカンマ区切りで入力（例: 仕事, アイデア, 重要）" 
                 class="input tags-input">
        </div>
        
        <div class="input-group">
          <label class="label" for="memo_new_description">内容</label>
          <%= f.text_area :description, 
                         placeholder: "今日は何を覚えておきますか？アイデアや重要な情報を自由に記録してください...", 
                         class: "input content-textarea",
                         rows: 20,
                         id: "memo_new_description" %>
        </div>
      </div>
      
      <div class="form-actions">
        <!-- 公開設定 -->
        <div class="visibility-group">
          <label class="label" for="memo_new_visibility">公開設定</label>
          <%= f.select :visibility, 
                      options_for_select([
                        ['プライベート', :private_memo],
                        ['公開', :public_memo],
                        ['共有', :shared]
                      ], :private_memo),
                      {},
                      { class: "input", id: "memo_new_visibility" } %>
        </div>
        
        <div class="action-buttons">
          <%= f.submit "作成", class: "btn btn-primary btn-lg" %>
        </div>
      </div>
    <% end %>
  </div>
<% end %> 
 