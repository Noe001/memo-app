<% if @can_add %>
  <!-- 他ユーザーのメモを追加 -->
  <div class="memo-form">
    <%= form_with model: @memo_to_add, 
                  url: add_memo_memo_path(@selected), 
                  method: :post, 
                  local: true,
                  data: { controller: "memo-form" } do |f| %>
      <div class="form-header">
        <h2 class="form-title">メモを追加</h2>
        <div class="shared-info">
          <i data-lucide="user" class="w-4 h-4"></i>
          <span>共有元: <strong><%= @shared_user %></strong></span>
        </div>
      </div>
      
      <div class="form-body">
        <div class="input-group">
          <label class="label">タイトル</label>
          <%= f.text_field :title, 
                          placeholder: "メモのタイトルを入力", 
                          class: "input title-input",
                          "aria-label": "メモのタイトル" %>
        </div>
        
        <div class="input-group">
          <label class="label">内容</label>
          <%= f.text_area :description, 
                         placeholder: "メモの内容を入力してください...", 
                         class: "input content-textarea",
                         rows: 20,
                         "aria-label": "メモの内容" %>
        </div>
        
        <!-- タグ入力 -->
        <div class="input-group">
          <label class="label">タグ</label>
          <input type="text" 
                 name="tags" 
                 placeholder="タグをカンマ区切りで入力（例: 仕事, アイデア）" 
                 class="input tags-input"
                 aria-label="タグ">
        </div>
        
        <!-- 公開設定 -->
        <div class="input-group">
          <label class="label">公開設定</label>
          <%= f.select :visibility, 
                      options_for_select([
                        ['プライベート', 'private_memo'],
                        ['公開', 'public_memo'],
                        ['共有', 'shared']
                      ], @memo_to_add.visibility),
                      {},
                      { class: "input", "aria-label": "公開設定" } %>
        </div>
      </div>
      
      <div class="form-actions">
        <%= f.submit "追加", class: "btn btn-primary" %>
        <%= link_to "キャンセル", root_path, class: "btn btn-secondary" %>
      </div>
    <% end %>
  </div>
<% elsif @selected.present? %>
  <!-- 自分のメモの編集 -->
  <div class="memo-form">
    <%= form_with model: @selected, 
                  local: true,
                  data: { controller: "memo-form" } do |f| %>
      <div class="form-header">
        <h2 class="form-title">メモを編集</h2>
        <div class="form-meta">
          <time datetime="<%= @selected.updated_at.iso8601 %>">
            最終更新: <%= @selected.updated_at.strftime("%Y年%m月%d日 %H:%M") %>
          </time>
        </div>
      </div>
      
      <div class="form-body">
        <div class="input-group">
          <label class="label">タイトル</label>
          <%= f.text_field :title, 
                          placeholder: "メモのタイトルを入力", 
                          class: "input title-input",
                          "aria-label": "メモのタイトル" %>
        </div>
        
        <div class="input-group">
          <label class="label">内容</label>
          <%= f.text_area :description, 
                         placeholder: "メモの内容を入力してください...", 
                         class: "input content-textarea",
                         rows: 20,
                         "aria-label": "メモの内容" %>
        </div>
        
        <!-- タグ入力 -->
        <div class="input-group">
          <label class="label">タグ</label>
          <input type="text" 
                 name="tags" 
                 value="<%= @selected.tags.pluck(:name).join(', ') %>"
                 placeholder="タグをカンマ区切りで入力（例: 仕事, アイデア）" 
                 class="input tags-input"
                 aria-label="タグ">
        </div>
        
        <!-- 公開設定 -->
        <div class="input-group">
          <label class="label">公開設定</label>
          <%= f.select :visibility, 
                      options_for_select([
                        ['プライベート', 'private_memo'],
                        ['公開', 'public_memo'],
                        ['共有', 'shared']
                      ], @selected.visibility),
                      {},
                      { class: "input", "aria-label": "公開設定" } %>
        </div>
      </div>
      
      <div class="form-actions">
        <%= f.submit "更新", class: "btn btn-primary" %>
        <%= button_to "削除", memo_path(@selected.id), 
                      method: :delete, 
                      class: "btn btn-destructive",
                      confirm: "本当に削除しますか？この操作は取り消せません。",
                      title: "このメモを完全に削除します" %>
        <%= link_to "エクスポート", export_memos_path(format: :json), 
                    class: "btn btn-secondary",
                    title: "メモをJSONファイルとしてエクスポート" %>
      </div>
    <% end %>
  </div>
<% else %>
  <!-- 新規メモ作成 -->
  <div class="memo-form">
    <%= form_with model: @memo_new, 
                  url: memos_path, 
                  method: :post, 
                  local: true,
                  data: { controller: "memo-form" } do |f| %>
      <div class="form-header">
        <h2 class="form-title">新しいメモ</h2>
        <p class="form-meta">アイデアや重要な情報を記録しましょう</p>
      </div>
      
      <div class="form-body">
        <div class="input-group">
          <label class="label">タイトル</label>
          <%= f.text_field :title, 
                          placeholder: "メモのタイトルを入力", 
                          class: "input title-input",
                          "aria-label": "メモのタイトル" %>
        </div>
        
        <div class="input-group">
          <label class="label">内容</label>
          <%= f.text_area :description, 
                         placeholder: "今日は何を覚えておきますか？アイデアや重要な情報を自由に記録してください...", 
                         class: "input content-textarea",
                         rows: 20,
                         "aria-label": "メモの内容" %>
        </div>
        
        <!-- タグ入力 -->
        <div class="input-group">
          <label class="label">タグ</label>
          <input type="text" 
                 name="tags" 
                 placeholder="タグをカンマ区切りで入力（例: 仕事, アイデア, 重要）" 
                 class="input tags-input"
                 aria-label="タグ">
        </div>
        
        <!-- 公開設定 -->
        <div class="input-group">
          <label class="label">公開設定</label>
          <%= f.select :visibility, 
                      options_for_select([
                        ['プライベート', 'private_memo'],
                        ['公開', 'public_memo'],
                        ['共有', 'shared']
                      ], 'private_memo'),
                      {},
                      { class: "input", "aria-label": "公開設定" } %>
        </div>
      </div>
      
      <div class="form-actions">
        <%= f.submit "作成", class: "btn btn-primary btn-lg" %>
      </div>
    <% end %>
  </div>
<% end %> 
